var loyaltyCardApp=angular.module("loyaltyCardApp",[]);loyaltyCardApp.controller("CardController",function(r,e){var o=this;o.cardList=[],o.getcardList=function(){e.getAllCards().then(function(r){o.cardList=r},function(e){r.alert(e)})},o.addTodo=function(){e.addCard(o.card).then(function(){o.refreshList(),o.todoText=""},function(e){r.alert(e)})}});var app=angular.module("loyaltyCardApp",[]);app.factory("indexedDb",function(r,e){function o(){var r=new Promise(function(r,e){console.log("openDb ...");var o=indexedDB.open(c,d);o.onsuccess=function(e){i=this.result,console.log("openDb DONE"),r()},o.onerror=function(r){console.error("openDb:",r.target.errorCode),e("Error opening db:",r.target.errorCode)},o.onupgradeneeded=function(r){console.log("openDb.onupgradeneeded");var e=r.currentTarget.result.createObjectStore(u,{keyPath:"Id",autoIncrement:!0});e.createIndex("Name","Name",{unique:!1}),e.createIndex("Description","Description",{unique:!1}),e.createIndex("Barcode","Barcode",{unique:!1})}});return r}function n(r,e){var o=i.transaction(r,e);return o.objectStore(r)}function t(){console.log("Get all cards");var r=n(u,"readonly"),e=new Promise(function(e,o){var n=r.openCursor();n.onsuccess=function(o){var t=[],a=o.target.result;a?(console.log("getAllCards cursor:",a),n=r.get(a.key),n.onsuccess=function(r){var e=r.target.result,o={Id:e.Id,Name:e.Name,Description:e.Description,Barcode:e.Barcode};t.push(o)},a["continue"]()):(console.log("No more entries"),e(t))},n.onerror=function(r){console.error("openDb:",evt.target.errorCode),o("Error opening db:",evt.target.errorCode)}});return e}function a(r){var e=n(u,"readonly"),o=new Promise(function(o,n){var t=e.get(r);t.onsuccess=function(r){o(t.result)},t.onerror=function(e){console.error("Error getting data for",r),n("Error getting data for",r)}});return o}const c="LoyaltyCodesDb",d=2,u="Cards";var i;return{openDb:o,getCard:a,getAllCards:t}});