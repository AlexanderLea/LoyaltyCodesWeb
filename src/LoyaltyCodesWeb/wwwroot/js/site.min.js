!function(){"use strict";var r=angular.module("LoyaltyCardApp",["ngRoute","ui.router","io-barcode"]);r.config(function(r,o,e){o.html5Mode(!0),r.when("/",{templateUrl:"pages/cards.html",controller:"cardController"}).when("/create",{templateUrl:"pages/createCard.html",controller:"createCardController"}).when("/view/:id",{templateUrl:"pages/viewCard.html",controller:"viewCardController"}).otherwise({redirectTo:"/"})})}(),function(){"use strict";var r=angular.module("LoyaltyCardApp");r.controller("cardController",["$rootScope","$scope","$window","$location","indexedDbFactory",function(r,o,e,n,t){function a(){t.openDb().then(function(){d=!0,c()},function(r){console.log("error.",r)})}function c(){d?t.getAllCards().then(function(r){o.cardList=r,o.$apply()},function(r){console.log("error.",r)}):a()}function i(r){n.path("/view/"+r.Id)}r.title="Loyalty Cards - View Cards";var d=!1;o.cardList=[],o.showCard=i,o.refreshCards=c,o.loadData=a}]),r.controller("createCardController",["$rootScope","$scope","$window","indexedDbFactory",function(r,o,e,n){r.title="Loyalty Cards - Create Card";var t=!1;n.openDb().then(function(){t=!0},function(r){console.log("error.",r)}),o.addCard=function(){var r={Name:o.Name,Description:o.Description,Barcode:o.Barcode};n.addCard(r).then(function(){e.location.href="/"},function(r){})}}]),r.controller("viewCardController",["$rootScope","$scope","$window","$routeParams","indexedDbFactory",function(r,o,e,n,t){function a(){var r=n.id;c?t.getCard(r).then(function(r){o.card=r,o.$apply()},function(r){console.log("error.",r)}):t.openDb().then(function(){c=!0,a()},function(r){console.log("error.",r)})}r.title="Loyalty Cards - Card Details";var c=!1;o.card=null,a()}])}(),function(){"use strict";function r(){function r(){var r=new Promise(function(r,o){var e=indexedDB.open(a,c);e.onsuccess=function(o){d=this.result,console.log("Db open"),r()},e.onerror=function(r){console.error("openDb:",r.target.errorCode),o("Error opening db:",r.target.errorCode)},e.onupgradeneeded=function(r){console.log("openDb.onupgradeneeded");var o=r.currentTarget.result.createObjectStore(i,{keyPath:"Id",autoIncrement:!0});o.createIndex("Name","Name",{unique:!1}),o.createIndex("Description","Description",{unique:!1}),o.createIndex("Barcode","Barcode",{unique:!1})}});return r}function o(r,o){var e=d.transaction(r,o);return e.objectStore(r)}function e(r){var e=o(i,"readwrite"),n=new Promise(function(o,n){var t=e.add(r);t.onsuccess=function(r){console.log("Insertion in DB successful"),o()},t.onerror=function(){console.error("Error Inserting into db",this.error),n("Error Inserting into db",this.error)}});return n}function n(){console.log("Get all cards");var r=o(i,"readonly"),e=new Promise(function(o,e){var n=r.openCursor(),t=[];n.onsuccess=function(e){var a=e.target.result;a?(n=r.get(a.key),n.onsuccess=function(r){var o=r.target.result,e={Id:o.id,Name:o.Name,Description:o.Description,Barcode:o.Barcode};t.push(e)},a["continue"]()):(console.log("No more entries. cardList:",t),o(t))},n.onerror=function(r){console.error("openDb:",r.target.errorCode),e("Error opening db:",r.target.errorCode)}});return e}function t(r){var e=o(i,"readonly"),n=new Promise(function(o,n){var t=parseInt(r),a=e.get(t);a.onsuccess=function(e){var n=e.target.result;n?o(n):console.log("no values returned for id:",r)},a.onerror=function(o){console.error("Error getting data for",r),n("Error getting data for",r)}});return n}const a="LoyaltyCodesDb",c=2,i="Cards";var d;return{openDb:r,getCard:t,getAllCards:n,addCard:e}}var o=angular.module("LoyaltyCardApp");o.factory("indexedDbFactory",[r])}();