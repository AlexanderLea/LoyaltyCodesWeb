!function(){"use strict";var r=angular.module("LoyaltyCardApp",["ngRoute","ui.router","io-barcode"]);r.config(function(r,e,o){e.html5Mode(!0),r.when("/",{templateUrl:"pages/cards.html",controller:"cardController"}).when("/create",{templateUrl:"pages/createCard.html",controller:"createCardController"}).when("/view/:id",{templateUrl:"pages/viewCard.html",controller:"viewCardController"}).otherwise({redirectTo:"/"})})}(),function(){"use strict";var r=angular.module("LoyaltyCardApp");r.controller("cardController",["$scope","$window","$location","indexedDbFactory",function(r,e,o,n){function t(){n.openDb().then(function(){i=!0,a()},function(r){console.log("error.",r)})}function a(){i?n.getAllCards().then(function(e){r.cardList=e,r.$apply()},function(r){console.log("error.",r)}):t()}function c(r){o.path("/view/"+r.Id)}var i=!1;r.cardList=[],r.showCard=c,r.refreshCards=a,r.loadData=t}]),r.controller("createCardController",["$scope","$window","indexedDbFactory",function(r,e,o){var n=!1;o.openDb().then(function(){n=!0},function(r){console.log("error.",r)}),r.addCard=function(){var n={Name:r.Name,Description:r.Description,Barcode:r.Barcode};o.addCard(n).then(function(){e.location.href="/"},function(r){})}}]),r.controller("viewCardController",["$scope","$window","$routeParams","indexedDbFactory",function(r,e,o,n){function t(){var e=o.id;a?n.getCard(e).then(function(e){r.card=e,r.$apply()},function(r){console.log("error.",r)}):n.openDb().then(function(){a=!0,t()},function(r){console.log("error.",r)})}var a=!1;r.card=null,t()}])}(),function(){"use strict";function r(){function r(){var r=new Promise(function(r,e){var o=indexedDB.open(a,c);o.onsuccess=function(e){d=this.result,console.log("Db open"),r()},o.onerror=function(r){console.error("openDb:",r.target.errorCode),e("Error opening db:",r.target.errorCode)},o.onupgradeneeded=function(r){console.log("openDb.onupgradeneeded");var e=r.currentTarget.result.createObjectStore(i,{keyPath:"Id",autoIncrement:!0});e.createIndex("Name","Name",{unique:!1}),e.createIndex("Description","Description",{unique:!1}),e.createIndex("Barcode","Barcode",{unique:!1})}});return r}function e(r,e){var o=d.transaction(r,e);return o.objectStore(r)}function o(r){var o=e(i,"readwrite"),n=new Promise(function(e,n){var t=o.add(r);t.onsuccess=function(r){console.log("Insertion in DB successful"),e()},t.onerror=function(){console.error("Error Inserting into db",this.error),n("Error Inserting into db",this.error)}});return n}function n(){console.log("Get all cards");var r=e(i,"readonly"),o=new Promise(function(e,o){var n=r.openCursor(),t=[];n.onsuccess=function(o){var a=o.target.result;a?(n=r.get(a.key),n.onsuccess=function(r){var e=r.target.result,o={Id:e.id,Name:e.Name,Description:e.Description,Barcode:e.Barcode};t.push(o)},a["continue"]()):(console.log("No more entries. cardList:",t),e(t))},n.onerror=function(r){console.error("openDb:",r.target.errorCode),o("Error opening db:",r.target.errorCode)}});return o}function t(r){var o=e(i,"readonly"),n=new Promise(function(e,n){var t=parseInt(r),a=o.get(t);a.onsuccess=function(o){var n=o.target.result;n?e(n):console.log("no values returned for id:",r)},a.onerror=function(e){console.error("Error getting data for",r),n("Error getting data for",r)}});return n}const a="LoyaltyCodesDb",c=2,i="Cards";var d;return{openDb:r,getCard:t,getAllCards:n,addCard:o}}var e=angular.module("LoyaltyCardApp");e.factory("indexedDbFactory",[r])}();